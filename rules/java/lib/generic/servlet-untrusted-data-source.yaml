rules:
  - id: java-servlet-untrusted-data-source
    options:
      lib: true
    severity: NOTE
    message: Untrusted data flows from here
    languages:
      - java
    patterns:
      - pattern-either:
          - patterns:
              - pattern: |
                  $RETURNTYPE $ENTRYPOINT(..., HttpServletRequest $UNTRUSTED,...) {
                  ...
                  }
              - metavariable-pattern:
                  metavariable: $ENTRYPOINT
                  pattern-either:
                    - pattern: doDelete
                    - pattern: doGet
                    - pattern: doPost
                    - pattern: doPut
                    - pattern: doTrace
                    - pattern: _jspService
          - pattern: |
              $UNTRUSTED = (MessageBodyReader $READER).readFrom(...);
          - patterns:
            - pattern: |
                $FILES = ($FILE_UPLOAD_TYPE $SFU).parseRequest((HttpServletRequest $REQ));
                ...
                $UNTRUSTED =  $FILES.iterator().next().getName();
            - metavariable-regex:
                metavariable: $FILE_UPLOAD_TYPE
                regex: .*FileUpload.*
          - pattern: |
              $UNTRUSTED = ($X.servlet.http.Part $PART).getSubmittedFileName();
