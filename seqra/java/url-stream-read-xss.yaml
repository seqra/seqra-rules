rules:
  - id: url-stream-read-xss
    message: "Writing user input directly to a web page allows for a cross-site scripting vulnerability."
    metadata:
      shortDescription: "Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')"
      cwe: CWE-79
    severity: ERROR
    patterns:
      - pattern-either:
        - pattern-inside: |
            @ANNOTATION(...)
            $RETURNTYPE $METHOD(..., String $RAW_URL, ...) {
            ...
            }
      - metavariable-pattern:
          metavariable: $ANNOTATION
          pattern-either:
          - pattern: RequestMapping
          - pattern: DeleteMapping
          - pattern: GetMapping
          - pattern: PatchMapping
          - pattern: PostMapping
          - pattern: PutMapping
      - pattern-either:
        - pattern-inside: |
            URL $URL = new URL($RAW_URL);
            URLConnection $URL_CONN = $URL.openConnection();
            ...
        - pattern-inside: |
            URL $URL = new URL($RAW_URL);
            $URL_CONN = $URL.openConnection();
            ...
      - pattern: |
          InputStream $IS = $URL_CONN.getInputStream();
          InputStreamReader $ISR = new InputStreamReader($IS);
          BufferedReader $READER = new BufferedReader($ISR);
          String $INPUT = $READER.readLine();
          return $INPUT;
    languages:
      - java
